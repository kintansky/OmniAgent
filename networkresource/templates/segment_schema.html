{% extends 'base.html' %}
{% block title %} 网段规划 {% endblock %}

{% load static %}
{% block header_extends %}
    <link rel="stylesheet" href="{% static 'devices.css' %}">
{% endblock %}

{% block navbar_resource_active %}active{% endblock %}

{% block subheader %}
    网段规划
{% endblock %}

{% block content %}
<div class="container-fluid">
    <br>
    <ol class="breadcrumb">
        <li><a href="{% url 'dashboard' %}">Home</a></li>
        <li>resource</li>
        <li class="active">新增网段</li>
    </ol>
    <h2 class="sub-header">在用网段情况</h2>
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-md-8">
                                    新增网段
                                </div>
                                <div class="col-md-4">
                                    <div class="btn-group btn-group-xs pull-right" role="group" aria-label="...">
                                        <button id="reset_btn" type="button" class="btn btn-danger">重置</button>
                                        <button id="new_segment_btn" type="submit" class="btn btn-success">确认新增</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <form class="form-inline" id="new_segment_form" action="" method="POST">
                                <div class="row">
                                    {% for field in new_ip_segment_form %}
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                                            {{ field }}
                                        </div>
                                    </div>
                                    {% endfor %}
                                    <div class="btn-group" role="group" aria-label="...">
                                        <button type="reset" class="btn btn-danger" style="display: none;">重置</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <form class="form-inline" action="{% url 'search_segment' %}" method="GET">
                                        <div class="form-group">
                                            <label for="id_ip"></label>
                                            <input type="text" name="ip" class="form-control" placeholder="192.168.1.0" required="" id="id_ip">
                                        </div>
                                        <button type="submit" class="btn btn-primary">搜索</button>
                                    </form>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>地址段</th>
                                                    <th>专业</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for record in records %}
                                                <tr>
                                                    <td>{{ record.id }}</td>
                                                    <td>{{ record.upper_segment }} / {{ record.upper_mask }}</td>
                                                    <td>
                                                        {{ record.specialization }}
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-primary btn-xs schema_detail_btn" rdata="{{ record.id }}">点击规划</button>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-2 counter">
                    <p class="counter">
                        <span class="glyphicon glyphicon-credit-card" aria-hidden="true"></span>
                        Found <strong>{{ page_of_objects.paginator.count }}</strong> records
                    </p>
                </div>
                <div class="col-lg-10">
                    <div class="paginator">
                        <ul class="pagination">
                            {# 上一页 #}
                            <li>
                                {% if page_of_objects.has_previous %}
                                    <a href="?page={{ page_of_objects.previous_page_number }}{{ search_paras }}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                {% else %}
                                    <span aria-hidden="true">&laquo;</span>
                                {% endif %}
                            </li>
                            {# 中间页码 #}
                            {% for page_num in page_range %}
                                {% if page_num == page_of_objects.number %}
                                    <li class='active'><span>{{ page_num }}</span></li>
                                {% else %}
                                    {% if page_num == '...' %}
                                        <li><span>{{ page_num }}</span></li>
                                    {% else %}
                                        <li><a href="?page={{ page_num }}{{ search_paras }}">{{ page_num }}</a></li>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            {# 下一页 #}
                            <li>
                                {% if page_of_objects.has_next %}
                                    <a href="?page={{ page_of_objects.next_page_number }}{{ search_paras }}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                {% else %}
                                    <span aria-hidden="true">&raquo;</span>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            已规划
                                        </div>
                                        <div class="panel-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>地址段</th>
                                                            <th>网关</th>
                                                            <th>剩余/容量</th>
                                                            <th>操作</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="schemaed_segment_tb"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="panel panel-info">
                                        <div class="panel-heading">
                                            待规划
                                        </div>
                                        <div class="panel-body">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>地址段</th>
                                                        <th>容量</th>
                                                        <th>规划</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="unschemaed_segment_tb"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="segment_schema_modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">规划情况</h4>
            </div>
            <div class="modal-body">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        草稿
                        <button id="confirm-draft" type="submit" class="btn btn-success btn-xs pull-right" data-toggle="popover" data-placement="auto bottom" data-trigger="manual" title="提示" data-content="后台正在处理，请稍后...">确认</button>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>子网段</th>
                                    <th>网关</th>
                                    <th>接入方式</th>
                                    <th>关联BNG</th>
                                    <th>关联OLT/PTN</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="draft-segment"></tbody>
                        </table>
                    </div>
                </div>
                <p><strong>可通过以下两种方式添加,添加完成后点击右上角 确认清单</strong></p>
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">单个子网规划</div>
                            <div class="panel-body">
                                <form id="tatget_and_drafted_form" action="" style="display: none;">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="id_target_net" class="col-sm-6 control-label">目标网段</label>
                                                <input type="text" name="target_net" class="form-control" id="id_target_net">
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="id_drafted_net" class="col-sm-6 control-label">已加入草稿</label>
                                                <input type="text" name="drafted_net" class="form-control" id="id_drafted_net">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <form id="segment-draft-form" action="" method="GET">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.search_olt.id_for_label }}" class="col-sm-6 control-label">{{ new_draft_segment_base_form.search_olt.label }}?</label>
                                                {{ new_draft_segment_base_form.search_olt }}
                                                <div id="olt-list" class="olt-list"></div>
                                                <p class="text-danger error-data" id="id_error_search_olt">{{ new_draft_segment_base_form.search_olt.errors.as_text }}</p>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.access_olt.id_for_label }}" class="col-sm-6 control-label" >{{ new_draft_segment_base_form.access_olt.label }}</label>
                                                {{ new_draft_segment_base_form.access_olt }}
                                                <p class="text-danger error-data" id="id_error_access_olt">{{ new_draft_segment_base_form.access_olt.errors.as_text }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.search_bng.id_for_label }}" class="col-sm-6 control-label">{{ new_draft_segment_base_form.search_bng.label }}?</label>
                                                {{ new_draft_segment_base_form.search_bng }}
                                                <div id="bng-list" class="bng-list"></div>
                                                <p class="text-danger error-data" id="id_error_search_bng">{{ new_draft_segment_base_form.search_bng.errors.as_text }}</p>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.access_bng.id_for_label }}" class="col-sm-6 control-label" >{{ new_draft_segment_base_form.access_bng.label }}</label>
                                                {{ new_draft_segment_base_form.access_bng }}
                                                <p class="text-danger error-data" id="id_error_access_bng">{{ new_draft_segment_base_form.access_bng.errors.as_text }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.access_type.id_for_label }}" class="control-label" >{{ new_draft_segment_base_form.access_type.label }}</label>
                                                {{ new_draft_segment_base_form.access_type }}
                                                <p class="text-danger error-data" id="id_error_access_type">{{ new_draft_segment_base_form.access_type.errors.as_text }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.draft_type.id_for_label }}" class="control-label" >{{ new_draft_segment_base_form.draft_type.label }}</label>
                                                {{ new_draft_segment_base_form.draft_type }}
                                                <p class="text-danger error-data" id="id_error_draft_type">{{ new_draft_segment_base_form.draft_type.errors.as_text }}</p>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.draft_type_addon.id_for_label }}" class="control-label" >{{ new_draft_segment_base_form.draft_type_addon.label }}</label>
                                                {{ new_draft_segment_base_form.draft_type_addon }}
                                                <p class="text-danger error-data" id="id_draft_type_addon">{{ new_draft_segment_base_form.draft_type_addon.errors.as_text }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.amount.id_for_label }}" class="control-label" >{{ new_draft_segment_base_form.amount.label }}</label>
                                                {{ new_draft_segment_base_form.amount }}
                                                <p class="text-danger error-data" id="id_error_bng">{{ new_draft_segment_base_form.amount.errors.as_text }}</p>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label for="{{ new_draft_segment_base_form.gateway.id_for_label }}" class="control-label" >{{ new_draft_segment_base_form.gateway.label }}</label>
                                                {{ new_draft_segment_base_form.gateway }}
                                                <p class="text-danger error-data" id="id_error_bng">{{ new_draft_segment_base_form.gateway.errors.as_text }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="reset" class="btn btn-danger" style="display: none;">重置</button>
                                </form>
                                <button type="submit" class="btn btn-success btn-sm" id="confirm-to-draft">加入草稿</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block tail_script %}
<script>
    $(document).ready(function(){
        $('#reset_btn').click(function(){
            $(':reset').trigger('click');
        });

        // 新增segment
        $('#new_segment_btn').click(function(){
            $('#loading').modal('show');
            $.ajax({
                url: "{% url 'ajax_allocate_segment' %}",
                type: "POST",
                data: $("#new_segment_form").serialize()+"&csrfmiddlewaretoken="+"{{ csrf_token }}",
                cache: false,
                success: function(data){
                    if(data['status'] == 'success'){
                        $('#loading').modal('hide');
                        alert('新增成功');
                        // window.location.reload();
                        window.location.replace("{% url 'list_all_segment' %}");
                    }else{
                        $('#loading').modal('hide');
                        alert('新增失败：' + data['error_info']);
                    }
                },
                error: function(xhr){
                    $('#loading').modal('hide');
                    console.log(xhr);
                }
            });
        });

        // 请求在用情况
        $('.schema_detail_btn').click(function(){
            $('#schemaed_segment_tb').html('');
            $('#unschemaed_segment_tb').html('');
            var rdata = $(this).attr('rdata');
            $.ajax({
                url: "{% url 'schema_detail' %}",
                type: "GET",
                data: "rdata=" + rdata,
                cache: false,
                success: function(data){
                    if(data['status'] == 'success'){
                        // console.log(data['schemaed_segment']);
                        // 已规划部分
                        var seg_list = JSON.parse(data['schemaed_segment']);
                        for(var i in seg_list){
                            $('#schemaed_segment_tb').append('<tr><td>'+seg_list[i]['subnet']+'</td><td>'+seg_list[i]['subnet_gateway']+'</td><td>'+seg_list[i]['unused']+'/'+seg_list[i]['total']+'</td>\
                                <td>\
                                    <div class="dropdown">\
                                        <button class="btn btn-primary btn-xs dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\
                                            操作\
                                            <span class="caret"></span>\
                                        </button>\
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\
                                            <li>\
                                                <a class="del_subnet" seg="'+seg_list[i]['subnet']+'">回收</a>\
                                            </li>\
                                            <li>\
                                                <a class="change_subnet" seg="'+seg_list[i]['subnet']+'">变更</a>\
                                            </li>\
                                        </ul>\
                                    </div>\
                                </td></tr>');
                        }
                        // 待规划部分
                        // console.log(data['unschemaed_segment']);
                        var un_seg_list = JSON.parse(data['unschemaed_segment']);
                        for(var i in un_seg_list){
                            $('#unschemaed_segment_tb').append('<tr><td>'+un_seg_list[i]['segment']+'</td><td>'+un_seg_list[i]['total']+'</td><td><button class="btn btn-primary btn-xs begin-schema" data-toggle="modal" data-target="#segment_schema_modal" seg="'+un_seg_list[i]['segment']+'">规划</button></td></tr>');
                        }
                    }else{
                        alert(data['error_info']);
                    }
                },
                error: function(xhr){
                    console.log(xhr);
                },
            });
        });
        // 回收
        $(document).on("click", ".del_subnet", function(){
            $.ajax({
                url: "{% url 'mod_schemaed_subnet' 'del' %}",
                type: 'POST',
                data: 'subnet='+$(this).attr('seg')+"&csrfmiddlewaretoken="+"{{ csrf_token }}",
                cache: false,
                success: function(data){
                    if(data['status'] == 'success'){
                        alert('回收成功');
                    }else{
                        alert('回收失败: ' + data['error_info']);
                    }
                    window.location.reload();
                },
                error: function(xhr){
                    console.log(xhr);
                }
            })
        })
        // 变更
        $(document).on("click", ".change_subnet", function(){
            // $.ajax({
            //     url: "{% url 'mod_schemaed_subnet' 'change' %}",
            //     type: 'POST',
            //     data: $(this).serialize()+"&csrfmiddlewaretoken="+"{{ csrf_token }}",
            //     cache: false,
            //     success: function(data){
            //         if(data['status'] == 'success'){
                        
            //         }else{

            //         }
            //     },
            //     error: function(xhr){
            //         console.log(xhr);
            //     }
            // })
        })

        // 开始规划按钮
        $(document).on("click", ".begin-schema", function(){
            // 清空表单
            $("p.error-data").text("");
            document.getElementById("segment-draft-form").reset();
            document.getElementById("tatget_and_drafted_form").reset();
            $("#draft-segment").html('');
            $('#id_target_net').val($(this).attr('seg'));
        });

        // 模糊匹配OLT清单
        $("#id_search_olt").keyup(function(){
            if($(this).val() == ""){
                $("#olt-list").css("display", "none");
                return;
            }
            $.ajax({
                url: "{% url 'get_schema_olt_bng' 'olt' %}",
                type: 'GET',
                data: $(this).serialize(),
                cache: false,
                success: function(data){
                    if(data['status'] == 'success'){
                        var olts = data['olt_list'].split(",");
                        var t = "<ul class=\"list-group\">";
                        for(var i=0;i<olts.length;i++){
                            // console.log(olts[i]);
                            t += "<li class=\"list-group-item olt-item\">"+olts[i]+"</li>";
                        }
                        t += "</ul>";
                        $("#olt-list").html(t);
                        $("#olt-list").css("display", "block");
                    }else{
                        // alert('error');
                        if("olt_count" in data){
                            $("#olt-list").css("display", "none");
                        }else{
                            var t = "<ul class=\"list-group\"><li class=\"list-group-item olt-item\">"+data["olt_list"]+"</li>";
                            $("#olt-list").html(t);
                            $("#olt-list").css("display", "block");
                        }
                    }
                },
                error: function(xhr){
                    console.log(xhr);
                }
            });
        });
        // 选择olt
        $(document).on("click", ".olt-item", function(){
            var auto_item = $(this).text();
            $("#olt-list").css("display", "none");
            if (auto_item != '无候选结果'){
                if ($("#id_access_olt").val() == ""){
                    $("#id_access_olt").val(auto_item);
                }else{
                    $("#id_access_olt").val($("#id_access_olt").val()+','+auto_item);
                }
            }
        });
        // 模糊匹配BNG清单
        $("#id_search_bng").keyup(function(){
            if($(this).val() == ""){
                $("#bng-list").css("display", "none");
                return;
            }
            $.ajax({
                url: "{% url 'get_schema_olt_bng' 'bng' %}",
                type: 'GET',
                data: $(this).serialize(),
                cache: false,
                success: function(data){
                    if(data['status'] == 'success'){
                        // console.log(data);
                        var bngs = data['bng_list'].split(",");
                        var t = "<ul class=\"list-group\">";
                        for(var i=0;i<bngs.length;i++){
                            t += "<li class=\"list-group-item bng-item\">"+bngs[i]+"</li>";
                        }
                        t += "</ul>";
                        $("#bng-list").html(t);
                        $("#bng-list").css("display", "block");
                    }else{
                        // alert('error');
                        if("bng_count" in data){
                            $("#bng-list").css("display", "none");
                        }else{
                            var t = "<ul class=\"list-group\"><li class=\"list-group-item bng-item\">"+data["bng_list"]+"</li>";
                            $("#bng-list").html(t);
                            $("#bng-list").css("display", "block");
                        }
                    }
                },
                error: function(xhr){
                    console.log(xhr);
                }
            });
        });
        // 选择bng
        $(document).on("click", ".bng-item", function(){
            var auto_item = $(this).text();
            $("#bng-list").css("display", "none");
            if (auto_item != '无候选结果'){
                if ($("#id_access_bng").val() == ""){
                    $("#id_access_bng").val(auto_item);
                }else{
                    $("#id_access_bng").val($("#id_access_bng").val()+','+auto_item);
                }
            }
        });
        // 单个网段规划生成草稿
        $("#confirm-to-draft").click(function(){
            $.ajax({
                url: "{% url 'confirm_segment_to_draft' %}",
                type: 'GET',
                data: $('#segment-draft-form').serialize()+'&'+$('#tatget_and_drafted_form').serialize(),
                cache: false,
                success: function(data){
                    if (data['status'] == 'success'){
                        //   console.log(data);
                        var draft_seg_list = JSON.parse(data['draft_segment'])
                        for (var i=0; i<draft_seg_list.length; i++){
                            var draft_seg = draft_seg_list[i];
                            var s = '<tr>';
                            for (var j=0; j<draft_seg.length; j++){
                                s += '<td>'+draft_seg[j]+'</td>';
                            }
                            s += '<td><button type="button" class="btn btn-danger btn-xs remove-draft" seg="'+draft_seg[0]+'">取消</button></td></tr>';
                            $('#draft-segment').append(s);
                        }
                        document.getElementById("segment-draft-form").reset();    // 清空表单
                        $('#id_drafted_net').val(data['drafted_net']);  // 将已加入草稿的回填进去
                    }else{
                        $("p.error-data").text("");
                        if ('error_info' in data){
                            alert("失败");
                            var error_data = JSON.parse(data['error_info']);
                            for (var key in error_data){
                                var item = error_data[key];
                                // console.log(item[0]['message']);
                                // 按照对应id补全错误信息
                                $("#id_error_"+key).text(item[0]['message']);
                            }
                        }
                        if ('other_error' in data){
                            alert(data['other_error']);
                        }
                    }
                },
                error: function(xhr){
                    console.log(xhr);
                }
            });
        });
        // 删除草稿
        $(document).on("click", ".remove-draft", function(){   // 动态绑定需要使用.on
            var remove_target = $(this).parent().parent();  // 需要删除的对象为btn的祖父
            var seg = $(this).attr('seg');
            var drafted_net_list = $('#id_drafted_net').val().split(',');
            // 重新生成drafted_net
            var ret = new Array();
            for (var i=0; i<drafted_net_list.length; i++){
                if (drafted_net_list[i] != seg){
                    ret.push(drafted_net_list[i]);
                }
            }
            // console.log(ret.join(','));
            $('#id_drafted_net').val(ret.join(','));
            // 其他情况直接删除即可
            remove_target.remove();
        });
        // 确认规划草稿
        $('#confirm-draft').click(function(){
            $('#confirm-draft').popover('show');
            var tr = $('#draft-segment').children('tr');
            var transfer_target = {};
            for (var i=0; i<tr.length; i++){
                var tmp = new Array();
                var td = tr[i].children;
                // console.log(td);
                for (var j=1; j<td.length-1; j++){
                    tmp.push(td[j].textContent);
                    // tmp.set(title[j], td[j].textContent);
                }
                transfer_target[td[0].textContent] = tmp;
            }
            // console.log(transfer_target);
            $.ajax({
                url: "{% url 'confirm_draft' %}",
                type: 'POST',
                data: 'schema_target='+JSON.stringify(transfer_target)+ "&csrfmiddlewaretoken=" + "{{ csrf_token }}",
                cache: false,
                success: function(data){
                    $('#confirm-draft').popover('hide');
                    if (data['status'] == 'success'){
                        alert('规划成功');
                        $('#segment_schema_modal').modal('hide');
                    }else{
                        alert('失败');
                    }
                },
                error: function(xhr){
                    console.log(xhr);
                    $('#confirm-draft').popover('hide');
                }
            });
        });
        // 选择掩码分配方式时的可选只分配一个段或者生成的都分配
        $('#id_draft_type').click(function(){
            // var  addon = $('#id_draft_type_addon');
            if ($(this).val() == '1'){
                $('#id_draft_type_addon').prop('disabled', true);
                $('#id_gateway').prop('disabled', false);
                // $('#id_gateway').prop('placeholder', '按掩码分配默认使用第一个地址作为网关');
            }else{
                $('#id_draft_type_addon').prop('disabled', false);
            }
        })
        $('#id_draft_type_addon').click(function(){
            if ($('#id_draft_type_addon').val() == '2'){
                $('#id_gateway').prop('disabled', true);
            }else{
                $('#id_gateway').prop('disabled', false);
            }
        })

    });
</script>
{% endblock %}